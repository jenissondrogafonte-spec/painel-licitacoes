<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Teste Real PNCP - Manual 2025</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f7f6; }
        .box { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 800px; margin: auto; }
        input, button { padding: 10px; margin: 5px 0; width: 100%; box-sizing: border-box; }
        button { background: #003366; color: white; border: none; font-weight: bold; cursor: pointer; }
        #log { margin-top: 20px; font-size: 12px; color: #666; background: #eee; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="box">
    <h3>üîç Teste de Conex√£o PNCP (Padr√£o Mar/25)</h3>
    <p style="font-size: 12px; color: red;">Nota: Use um intervalo de apenas 7 dias para o primeiro teste.</p>
    
    <label>In√≠cio (AAAA-MM-DD):</label>
    <input type="date" id="d1" value="2025-01-01">
    
    <label>Fim (AAAA-MM-DD):</label>
    <input type="date" id="d2" value="2025-01-07">

    <button onclick="testarAPI()">Testar Agora</button>

    <div id="status"></div>
    <div id="log">Logs de conex√£o aparecer√£o aqui...</div>
</div>

<script>
async function testarAPI() {
    const d1 = document.getElementById('d1').value;
    const d2 = document.getElementById('d2').value;
    const log = document.getElementById('log');
    const status = document.getElementById('status');

    status.innerHTML = "‚è≥ Tentando conex√£o...";
    
    // URL EXATA conforme Manual p√°g. 97 (Endpoint 10.7)
    const urlGov = `https://dadosabertos.compras.gov.br/modulo-contratacoes/7_consultarResultadoItensContratacoes_PNCP_14133?pagina=1&tamanhoPagina=10&dataPublicacaoPncpInicial=${d1}&dataPublicacaoPncpFinal=${d2}`;
    
    log.innerHTML = "Chamando: " + urlGov;

    try {
        // Usando o proxy AllOrigins para contornar o CORS
        const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(urlGov)}`);
        const resJson = await response.json();
        const data = JSON.parse(resJson.contents);

        if (data.resultado && data.resultado.length > 0) {
            status.innerHTML = "‚úÖ SUCESSO! Encontrados " + data.resultado.length + " itens.";
            status.style.color = "green";
        } else {
            status.innerHTML = "‚ö†Ô∏è API respondeu, mas a lista veio VAZIA. Tente outro per√≠odo de 2024.";
            status.style.color = "orange";
        }
    } catch (e) {
        status.innerHTML = "‚ùå ERRO: O servidor do governo bloqueou a requisi√ß√£o.";
        status.style.color = "red";
    }
}
</script>
</body>
</html>
