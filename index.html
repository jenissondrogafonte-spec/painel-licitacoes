<script>
document.getElementById('busca').onsubmit=async(e)=>{
e.preventDefault();
const uasg=document.getElementById('uasg').value;
const datai=document.getElementById('datai').value;
const dataf=document.getElementById('dataf').value;
const url=`https://dadosabertos.compras.gov.br/api/v1/licitacoes?uasg=${uasg}&data_publicacao_min=${datai}&data_publicacao_max=${dataf}&limit=20`;
document.getElementById('resultado').innerHTML='<p>Carregando...</p>';
try{
const r=await fetch(url);
const d=await r.json();
let html='<table><tr><th>NÂº</th><th>UASG</th><th>Data</th><th>Objeto</th></tr>';
if(d.resultado&&d.resultado.length){
d.resultado.forEach((l,i)=>html+=`<tr><td>${l.numero_aviso}</td><td>${l.uasg}</td><td>${l.data_publicacao}</td><td>${l.objeto?.slice(0,80)}</td></tr>`);
}else html+='<tr><td colspan=4>0 resultados UASG '+uasg+'</td></tr>';
html+='</table>';
document.getElementById('resultado').innerHTML=html;
}catch(e){document.getElementById('resultado').innerHTML='<p>Erro: '+e+'<br>Teste: <a href="https://dadosabertos.compras.gov.br/api/v1/licitacoes?uasg=926150" target="_blank">API direta</a></p>';}
}
</script>
