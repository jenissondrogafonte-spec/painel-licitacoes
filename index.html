<script>
async function buscarDados() {
    const d1 = document.getElementById('dataIni').value;
    const d2 = document.getElementById('dataFim').value;
    
    // URL EXATA do Módulo 10.7 (Pág. 97 do Manual / Documentação Postman)
    const urlBase = `https://dadosabertos.compras.gov.br/modulo-contratacoes/7_consultarResultadoItensContratacoes_PNCP_14133`;
    const params = `?pagina=1&tamanhoPagina=50&dataPublicacaoPncpInicial=${d1}&dataPublicacaoPncpFinal=${d2}`;
    
    try {
        const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(urlBase + params)}`);
        const wrapper = await response.json();
        const data = JSON.parse(wrapper.contents);

        // CORREÇÃO CRÍTICA: Acessar a chave 'resultado' conforme a documentação
        const lista = data.resultado || [];

        if (lista.length === 0) {
            alert("API conectada, mas nenhum dado encontrado para este período.");
            return;
        }

        // Desenhar tabela com os campos exatos do Postman
        let html = "";
        lista.forEach(item => {
            html += `<tr>
                <td>${item.idContratacaoPNCP}</td>
                <td>${item.niFornecedor}<br><small>${item.nomeRazaoSocialFornecedor}</small></td>
                <td>${item.descricaoItem}</td>
                <td>R$ ${item.valorTotalHomologado.toLocaleString('pt-BR')}</td>
            </tr>`;
        });
        document.getElementById('corpoTabela').innerHTML = html;

    } catch (e) {
        console.error("Falha ao ler documentação:", e);
    }
}
</script>
