<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Avan√ßado - PNCP</title>
    <style>
        :root { --primary: #003366; --accent: #0055aa; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); max-width: 1200px; margin: auto; }
        h2 { color: var(--primary); margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        /* Estilo dos Filtros */
        .filter-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; background: #eef2f7; padding: 15px; border-radius: 8px; }
        .filter-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 12px; font-weight: bold; color: #555; }
        input { padding: 10px; border: 1px solid #ccc; border-radius: 6px; }
        
        .btn-search { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; font-weight: bold; grid-column: span 1; align-self: end; }
        .btn-search:hover { background: var(--accent); }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: var(--primary); color: white; padding: 12px; text-align: left; font-size: 13px; }
        td { padding: 12px; border-bottom: 1px solid #eee; font-size: 13px; }
        tr:hover { background: #f9f9f9; }
        .status { font-weight: bold; margin: 10px 0; display: block; }
    </style>
</head>
<body>

<div class="card">
    <h2>üîç Consulta Personalizada - PNCP</h2>
    
    <div class="filter-grid">
        <div class="filter-group">
            <label>Data Inicial:</label>
            <input type="date" id="dataInicio" value="2025-01-01">
        </div>
        <div class="filter-group">
            <label>Data Final:</label>
            <input type="date" id="dataFim" value="2025-12-31">
        </div>
        <div class="filter-group">
            <label>Filtrar por CNPJ (Vencedor):</label>
            <input type="text" id="cnpjFiltro" placeholder="00.000.000/0000-00">
        </div>
        <button class="btn-search" onclick="consultarAPI()">Consultar Agora</button>
    </div>

    <span id="msgStatus" class="status">Preencha os filtros e clique em consultar.</span>

    <table>
        <thead>
            <tr>
                <th>Item / Descri√ß√£o</th>
                <th>CNPJ Vencedor</th>
                <th>Qtd</th>
                <th>Vlr Unit√°rio</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody id="tabelaCorpo">
            <tr><td colspan="5" style="text-align:center; padding: 30px; color: #999;">Aguardando par√¢metros...</td></tr>
        </tbody>
    </table>
</div>

<script>
async function consultarAPI() {
    const status = document.getElementById('msgStatus');
    const corpo = document.getElementById('tabelaCorpo');
    
    // Captura e formata as datas (de AAAA-MM-DD para AAAAMMDD)
    const dInicio = document.getElementById('dataInicio').value.replace(/-/g, "");
    const dFim = document.getElementById('dataFim').value.replace(/-/g, "");
    const cnpjInformado = document.getElementById('cnpjFiltro').value.replace(/\D/g, "");

    status.innerHTML = "‚è≥ Buscando dados no Governo...";
    status.style.color = "orange";

    // Endpoint oficial do M√≥dulo 07
    const urlGov = `https://dadosabertos.compras.gov.br/modulo-contratacoes/3_consultarResultadoItensContratacoes_PNCP_14133?pagina=1&tamanhoPagina=100&dataInicial=${dInicio}&dataFinal=${dFim}`;
    
    const proxy = `https://api.allorigins.win/get?url=${encodeURIComponent(urlGov)}`;

    try {
        const response = await fetch(proxy);
        const json = await response.json();
        const data = JSON.parse(json.contents);

        if (data.resultado && data.resultado.length > 0) {
            let lista = data.resultado;
