<script>
document.getElementById('form-busca').addEventListener('submit', async (e) => {
    e.preventDefault();
    const uasg = document.getElementById('uasg').value.trim();
    const objeto = document.getElementById('objeto').value.trim();
    if (!uasg && !objeto) {
        alert('Informe UASG ou objeto!');
        return;
    }
    const params = new URLSearchParams();
    if (uasg) params.append('uasg', uasg);
    if (objeto) params.append('objeto', objeto);
    params.append('limit', '50'); // Limita resultados
    const apiUrl = `http://compras.dados.gov.br/licitacoes/v1/licitacoes.json?${params}`;
    const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(apiUrl)}`;
    const tabela = document.getElementById('tabela-resultados');
    try {
        const response = await fetch(proxyUrl);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const data = await response.json();
        if (!data.resultado || data.resultado.length === 0) {
            alert('Nenhum resultado encontrado.');
            return;
        }
        const tbody = tabela.querySelector('tbody');
        tbody.innerHTML = '';
        data.resultado.slice(0, 20).forEach(lic => { // Primeiros 20
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${lic.numero_aviso || ''}</td>
                <td>${lic.objeto || ''}</td>
                <td>${lic.uasg || ''}</td>
                <td>${lic.data_publicacao || ''}</td>
            `;
            tbody.appendChild(row);
        });
        tabela.style.display = 'table';
    } catch (error) {
        console.error(error);
        alert(`Erro: ${error.message}. Tente UASG=389144.`);
    }
});
</script>
